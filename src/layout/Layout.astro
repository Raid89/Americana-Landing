---
import Contact from "@components/sections/Contact.astro";
import Footer from "@components/sections/Footer.astro";
import Header from "@components/sections/Header.astro";
import Hero from "@components/sections/Hero.astro";
import Information from "@components/sections/Information.astro";
import Opinions from "@components/sections/Opinions.astro";
import Statistics from "@components/sections/Statistics.astro";
---

<head>
  <script>
    // Cargar GSAP y ScrollTrigger secuencialmente
    (function() {
      // Cargar GSAP primero
      const gsapScript = document.createElement('script');
      gsapScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js';
      gsapScript.onload = function() {
        // Una vez cargado GSAP, cargar ScrollTrigger
        const scrollTriggerScript = document.createElement('script');
        scrollTriggerScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js';
        scrollTriggerScript.onload = function() {
          // Inicializar animaciones cuando ambos estén cargados
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGSAPAnimations);
          } else {
            initGSAPAnimations();
          }
        };
        document.head.appendChild(scrollTriggerScript);
      };
      document.head.appendChild(gsapScript);
    })();

    function initGSAPAnimations() {
      try {
        // Verificar que GSAP esté disponible
        if (typeof gsap === 'undefined' || typeof ScrollTrigger === 'undefined') {
          console.error('GSAP o ScrollTrigger no están disponibles');
          return;
        }

        gsap.registerPlugin(ScrollTrigger);
        
        // Configuración por defecto
        ScrollTrigger.defaults({
          start: "top 80%",
          end: "bottom top",
          toggleActions: "play none none reverse"
        });

        // Animaciones para la página principal
        initMainPageAnimations();
        
        console.log('✅ GSAP y ScrollTrigger inicializados correctamente');
      } catch (error) {
        console.error('Error al inicializar GSAP:', error);
      }
    }

    function initMainPageAnimations() {
      try {
        // Animación del Hero
        const heroSection = document.querySelector('[data-animate="hero"]');
        if (heroSection) {
          const textElements = heroSection.querySelectorAll('h1, h2, p, .academy-badge, .academy-highlight, .cta, button');
          
          if (textElements.length > 0) {
            gsap.set(textElements, { 
              opacity: 0, 
              y: 60,
              scale: 0.95
            });

            gsap.to(textElements, {
              opacity: 1,
              y: 0,
              scale: 1,
              duration: 0.8,
              ease: "power2.out",
              stagger: 0.15,
              scrollTrigger: {
                trigger: heroSection,
                start: "top 90%"
              }
            });
          }
        }

        // Animación de Estadísticas
        const statsSection = document.querySelector('[data-animate="stats"]');
        if (statsSection) {
          const statCards = statsSection.querySelectorAll('[data-stats="card"]');
          
          if (statCards.length > 0) {
            gsap.set(statCards, { 
              opacity: 0, 
              y: 80,
              scale: 0.9
            });

            gsap.to(statCards, {
              opacity: 1,
              y: 0,
              scale: 1,
              duration: 0.8,
              ease: "power2.out",
              stagger: 0.2,
              scrollTrigger: {
                trigger: statsSection,
                start: "top 80%"
              }
            });

            // Animar contadores
            statCards.forEach(function(card) {
              const numberElement = card.querySelector('[data-stats="number"]');
              if (numberElement) {
                const dataValue = numberElement.getAttribute('data-value');
                const targetValue = dataValue ? parseInt(dataValue) : 0;
                if (targetValue && !isNaN(targetValue)) {
                  const obj = { number: 0 };

                  gsap.to(obj, {
                    number: targetValue,
                    duration: 2.5,
                    ease: "power2.out",
                    onUpdate: function() {
                      const formattedNumber = Math.floor(obj.number).toLocaleString();
                      numberElement.textContent = "+ " + formattedNumber;
                    },
                    scrollTrigger: {
                      trigger: card,
                      start: "top 80%"
                    }
                  });
                }
              }
            });
          }
        }

        // Animación de Information (Showcase)
        const infoSection = document.querySelector('[data-animate="showcase"]');
        if (infoSection) {
          const items = infoSection.querySelectorAll('[data-showcase="item"]');
          
          if (items.length > 0) {
            gsap.set(items, { 
              opacity: 0, 
              y: 80,
              scale: 0.9
            });

            gsap.to(items, {
              opacity: 1,
              y: 0,
              scale: 1,
              duration: 0.8,
              ease: "power2.out",
              stagger: 0.2,
              scrollTrigger: {
                trigger: infoSection,
                start: "top 80%"
              }
            });
          }
        }

        // Animación de Opiniones (Grid)
        const opinionsSection = document.querySelector('[data-animate="grid"]');
        if (opinionsSection) {
          const opinionCards = opinionsSection.querySelectorAll('[data-grid="item"]');
          
          if (opinionCards.length > 0) {
            gsap.set(opinionCards, { 
              opacity: 0, 
              y: 80,
              scale: 0.9
            });

            gsap.to(opinionCards, {
              opacity: 1,
              y: 0,
              scale: 1,
              duration: 0.8,
              ease: "power2.out",
              stagger: 0.15,
              scrollTrigger: {
                trigger: opinionsSection,
                start: "top 80%"
              }
            });
          }
        }

        // Animación de Contacto (Benefits)
        const contactSection = document.querySelector('[data-animate="benefits"]');
        if (contactSection) {
          const formContainer = contactSection.querySelector('[data-benefit="form"]');
          const listContainer = contactSection.querySelector('[data-benefit="list"]');
          
          if (formContainer) {
            const formElements = formContainer.querySelectorAll('[data-benefit="title"], [data-benefit="subtitle"], [data-benefit="content"]');
            
            if (formElements.length > 0) {
              gsap.set(formElements, { 
                opacity: 0,
                x: -80,
                scale: 0.95
              });

              gsap.to(formElements, {
                opacity: 1,
                x: 0,
                scale: 1,
                duration: 0.8,
                ease: "power2.out",
                stagger: 0.15,
                scrollTrigger: {
                  trigger: formContainer,
                  start: "top 80%"
                }
              });
            }
          }

          if (listContainer) {
            const benefitItems = listContainer.querySelectorAll('[data-benefit="item"]');
            
            if (benefitItems.length > 0) {
              gsap.set(benefitItems, { 
                opacity: 0,
                x: 60,
                scale: 0.9
              });

              gsap.to(benefitItems, {
                opacity: 1,
                x: 0,
                scale: 1,
                duration: 0.6,
                ease: "power2.out",
                stagger: 0.1,
                scrollTrigger: {
                  trigger: listContainer,
                  start: "top 80%"
                }
              });
            }
          }
        }

        // Refresh ScrollTrigger
        setTimeout(function() {
          ScrollTrigger.refresh();
        }, 100);
        
      } catch (error) {
        console.error('Error en initMainPageAnimations:', error);
      }
    }
  </script>
</head>

<body class="main-layout">
  <Header />
  <div style="max-width: 1920px; margin: auto">
      <Hero title={'Aprende online con una academia moderna y flexible'} description={'Cursos y talleres en múltiples áreas. <br> Formación de calidad para impulsar tu desarrollo personal y profesional.'} />
  </div>
  <Statistics />
  <div style="max-width: 1920px; margin: auto">
      <Information />
      <Opinions />
      <Contact />
  </div>
  <Footer />
</body>

<style>
  .main-layout {
    padding-top: 90px; /* Altura aproximada del header */
    transition: padding-top 0.3s ease;
  }

  @media screen and (max-width: 1280px) {
    .main-layout {
      padding-top: 80px;
    }
  }

  @media screen and (max-width: 700px) {
    .main-layout {
      padding-top: 70px;
    }
  }
</style>

